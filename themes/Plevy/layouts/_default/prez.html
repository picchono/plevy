{{ if .Params.redirect }}
<meta http-equiv="Refresh" content="0; url='{{ .Params.redirect }}'" />{{ end }}
<!DOCTYPE html>
<html lang='{{ .Site.LanguageCode }}'>
{{- partial "head.html" . -}}

{{ $mainphoto := .Params.frontphoto }}
{{ $grad1 := "#f5f7faaa 0%"}}
{{ $grad2 := "#c3cfe2 40%"}}
{{ $titl := .Title }}
{{ $pagNumb := 0 }}

<body id="prez" style="background-color: #1c1c1c;">
    <div class="splide">
        <div class="splide__arrows">
            <button class="splide__arrow splide__arrow--prev h-2">
                {{ partial "icons.html" (dict "ico" "arrow" "hei" 1 "colo" "var(--color-primary-text)" "cla" "lh2") -}}
            </button>
            <button class="splide__arrow splide__arrow--next h-2">
                {{ partial "icons.html" (dict "ico" "arrow" "hei" 1 "colo" "var(--color-primary-text)" "cla" "lh2") -}}
            </button>
        </div>
        <div class="splide__track">
            <div class="splide__list">
                <div class="splide__slide">
                    <div class="backg"><img src="{{ $mainphoto }}" class="h-full w-full"></div>
                    <div class="grad" style="background-image: linear-gradient(135deg, {{ $grad1 }}, {{ $grad2 }});">
                    </div>
                    {{ partial "slide-side.html" . }}
                    <div class="px-6 pb-20">
                        <h1>{{ .Title }}</h1>
                        <p class="m-0 font-bold">Pierre Lévy - <a href="mailto:pierre.levy@lecnam.net"
                                class="font-normal">pierre.levy@lecnam.net</a></p>
                        <p class="Cnamletters"><span>C</span>onservatoire <span>n</span>ational des <span>a</span>rts et
                            <span>m</span>étiers
                        </p>
                        <div id="qrcode" class="p-2 bg-white rounded-lg absolute bottom-10"></div>
                    </div>
                </div>
                {{ if .Params.slides }}
                {{ $slid := .Params.slides }}
                {{ range $slid }}
                {{ $pagNumb = add $pagNumb 1 }}
                {{ $has := index . 0 }}
                {{ $sli := print "presentations/slides/" $has }}
                {{ if eq (index . 1) "img" }}
                <div class="splide__slide" data-splide-hash="{{ index . 0 }}">
                    <img class="h-full w-full object-contain border-0 rounded-lg" loading="lazy" src="{{ index . 2 }}"
                        title="{{ index . 0 }}">
                </div>
                {{ else if eq (index . 1) "youtube" }}
                <div class="splide__slide" data-splide-hash="{{ index . 0 }}">
                    <iframe src="https://www.youtube-nocookie.com/embed/{{ (index . 0) | safeURL }}"
                        class="w-full h-full object-contain" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen></iframe>
                </div>
                {{ else if eq (index . 1) "vimeo" }}
                <div class="splide__slide" data-splide-hash="{{ index . 0 }}">
                    <iframe src="https://player.vimeo.com/video/{{ index . 2 }}" class="w-full h-full object-contain"
                        frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
                </div>
                {{ else if eq (index . 1) "title" }}
                <div class="splide__slide" data-splide-hash="{{ $has }}">
                    <div class="backg"><img src="{{ $mainphoto }}" class="h-full w-full"></div>
                    <div class="grad" style="background-image: linear-gradient(135deg, {{ $grad1 }}, {{ $grad2 }});">
                    </div>
                    <div class="slide_sid">
                        <div class="py-5">{{ partial "icons.html" (dict "ico" "jprouve" "hei" 2 "colo"
                            "var(--color-primary-text)" "cla" "lh2") -}}</div>
                    </div>
                    <div class="slide_main p-0">
                        <h1>{{ index . 0 }}</h1>
                    </div>
                    <div class="absolute bottom-1 left-7 petitTxt">{{ $pagNumb }}/{{ $slid | len }} · Pierre Lévy | Cnam · <a
                        href="mailto:pierre.levy@lecnam.net" class="petitTxt">pierre.levy@lecnam.net</a> - {{ $titl
                    }}</div>
                </div>
                {{ else if eq (index . 1) "slide" }}
                {{ with $.Site.GetPage $sli }}
                <div class="splide__slide" data-splide-hash="{{ $has }}">
                    <div class="backg"><img src="{{ .Params.backphoto }}" class="h-full w-full object-contain"></div>
                    <div class="grad" style="background-image: linear-gradient(135deg, {{ if .Params.gradient }}
                        {{range .Params.gradient }}{{ (index . 0) }}, {{ (index . 1) }}{{ end }}
                        {{ else }}{{ $grad1 }}, {{ $grad2 }}{{ end }}); ">
                    </div>
                    {{ if false }}<div class="slide_sid">
                        <div class="py-5">{{ partial "icons.html" (dict "ico" "jprouve" "hei" 2 "colo"
                            "var(--color-primary-text)" "cla" "lh2") -}}</div>
                    </div>{{ end }}
                    <div class="slide_main">
                        {{ if eq .Params.slide "normal"}}
                        <h1>{{ .Title }}</h1>
                        {{ .Content | safeHTML }}
                        {{ else if eq .Params.slide "image-right"}}
                        <h1>{{ .Title }}</h1>
                        <div class="flex flex-row w-full justify-between">
                            <div class="w-2/3 pr-10 flex-grow">
                                {{ .Content | safeHTML }}
                            </div>
                            {{ range .Params.photos }}
                            <div class="w-1/3 flex-shrink flex-grow-0 flex flex-col">
                                <div class="imgright">
                                    <img class="" src="{{ index . 0 }}" title="{{ index . 1 }}">
                                </div>
                                <div class="petitTxt px-3 py-0.5 self-start">{{ index . 1 }}</div>
                            </div>
                            {{ end }}
                        </div>
                        {{ end}}
                    </div>
                    <div class="absolute bottom-1 left-7 petitTxt">{{ $pagNumb }}/{{ $slid | len }} · Pierre Lévy | Cnam · <a
                            href="mailto:pierre.levy@lecnam.net" class="petitTxt">pierre.levy@lecnam.net</a> - {{ $titl
                        }}
                    </div>
                </div>
                {{ end }}
                {{ end }}
                {{ end }}
                {{ end }}
                <div class="splide__slide">
                    <div class="backg"><img src="{{ $mainphoto }}" class="h-full w-full"></div>
                    <div class="grad" style="background-image: linear-gradient(135deg, {{ $grad1 }}, {{ $grad2 }});">
                    </div>
                    {{ partial "slide-side.html" . }}
                    <div class="px-6 pb-20">
                        <h1 class="pb-0">Merci !</h1>
                        <p class="text-2xl font-bold pb-20">{{ .Title }}</p>
                        <p class="m-0 font-bold">Pierre Lévy - <a href="mailto:pierre.levy@lecnam.net"
                                class="font-normal">pierre.levy@lecnam.net</a></p>
                        <p class="Cnamletters"><span>C</span>onservatoire <span>n</span>ational des <span>a</span>rts et
                            <span>m</span>étiers
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{ $splide_js := resources.Get "js/splide.js" | minify }}
    <script src="{{ $splide_js.Permalink }}" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    {{ $splideurl_js := resources.Get "js/splide-url.js" | minify }}
    <script src="{{ $splideurl_js.Permalink }}" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    {{ $splide_css := resources.Get "css/splide.css" | postCSS (dict "config" "./postcss.config.js") }}
    {{ $splide_css := $splide_css | minify }}
    <link rel="stylesheet" href="{{ $splide_css.Permalink }}" media="all">

    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="https://www.youtube.com/player_api"></script>

    {{ $qr_js := resources.Get "js/qrgen.js" | minify }}

    <script src="{{ $qr_js.Permalink }}"></script>
    <script defer="defer">
        const qrcode = new QRCode(document.getElementById('qrcode'), {
            text: {{ .Page.Permalink }},
        width: 500,
            height: 500,
                colorDark: '#000',
                    colorLight: '#fff',
                        correctLevel: QRCode.CorrectLevel.H
        });

        var splide = new Splide('.splide', {
            perPage: 1,
            focus: 0,
            omitEnd: true,
            height: 'calc(100vh - 2*var(--splide-padding))',
            width: 'calc(100wh - 2*var(--splide-padding))',
            gap: 'var(--splide-padding)',
            drag: true,
            snap: true,
            paginationDirection: 'ltr',
            keyboard: 'global',
            wheel: true,
            releaseWheel: true,
            speed: 700,
            autoplay: false
        }).mount(window.splide.Extensions);            
    </script>
</body>

</html>